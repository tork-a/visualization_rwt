ROSLIB.DiagnosticsDirectory=function(a,b,c){"undefined"==typeof b&&(b=null),"undefined"==typeof c&&(c=[]),this.parent=b,this.children=c,this.status=a.status,this.name=a.name},ROSLIB.DiagnosticsDirectory.prototype.findDirectory=function(a){if(this.name.toString()===a.toString())return this;if(0===this.children.length)return null;for(var b=0;b<this.children.length;b++){var c=this.children[b].findDirectory(a);if(null!==c)return c}return null},ROSLIB.DiagnosticsDirectory.prototype.addChild=function(a){this.children.push(a),a.parent=this},ROSLIB.DiagnosticsDirectory.prototype.createChild=function(a){var b=new ROSLIB.DiagnosticsDirectory({name:a},this);return this.addChild(b),b},ROSLIB.DiagnosticsDirectory.prototype.registerStatus=function(a){return this.status=a,a},ROSLIB.DiagnosticsDirectory.prototype.isChildrenHasError=function(){if(this.isErrorStatus())return this;for(var a=0;a<this.children.length;a++){var b=this.children[a].isChildrenHasError();if(b)return b}},ROSLIB.DiagnosticsDirectory.prototype.isErrorStatus=function(){return this.status?this.status.isERROR():!1},ROSLIB.DiagnosticsDirectory.prototype.fullName=function(){var a=function(b){if(null===b.parent)return"";var c=a(b.parent);return c+"/"+b.name};return a(this)},ROSLIB.DiagnosticsDirectory.prototype.uniqID=function(){var a=function(b){if(null===b.parent)return"";var c=a(b.parent);return 0===c.length?b.name:c+"-"+b.name};return a(this).replace(" ","-").replace("(","").replace(")","").replace("	","-")},ROSLIB.DiagnosticsDirectory.prototype.getAllDirectoriesWithoutRoot=function(){var a=this,b=a.getAllDirectories();return _.remove(b,function(b){return b===a}),b},ROSLIB.DiagnosticsDirectory.prototype.getAllDirectories=function(){var a=function(b){if(0===b.children.length)return[b];for(var c=[],d=0;d<b.children.length;d++){var e=a(b.children[d]);c=c.concat(e)}return c.push(b),c};return a(this)},ROSLIB.DiagnosticsDirectory.prototype.getDirectories=function(a){var b=function(c){if(0===c.children.length)return c.status&&c.status.level===a?[c]:[];for(var d=[],e=0;e<c.children.length;e++){var f=b(c.children[e]);d=d.concat(f)}return c.status&&c.status.level===a&&d.push(c),d};return b(this)},ROSLIB.DiagnosticsDirectory.prototype.getErrorDirectories=function(){return this.getDirectories(ROSLIB.DiagnosticsStatus.LEVEL.ERROR)},ROSLIB.DiagnosticsDirectory.prototype.getWarnDirectories=function(){return this.getDirectories(ROSLIB.DiagnosticsStatus.LEVEL.WARN)},ROSLIB.DiagnosticsDirectory.prototype.getOkDirectories=function(){return this.getDirectories(ROSLIB.DiagnosticsStatus.LEVEL.OK)},ROSLIB.DiagnosticsDirectory.prototype.findByName=function(a){if(this.status&&this.status.name.toString()===a.toString())return this;for(var b=0;b<this.children.length;b++){var c=this.children[b].findByName(a);if(c)return c}return null},ROSLIB.DiagnosticsDirectory.prototype.getIconHTML=function(){return this.status.level===ROSLIB.DiagnosticsStatus.LEVEL.OK?'<span class="glyphicon-ok glyphicon"></span>':this.status.level===ROSLIB.DiagnosticsStatus.LEVEL.WARN?'<span class="glyphicon-exclamation-sign glyphicon"></span>':this.status.level===ROSLIB.DiagnosticsStatus.LEVEL.ERROR?'<span class="glyphicon-minus-sign glyphicon"></span>':void 0},ROSLIB.DiagnosticsDirectory.prototype.getCollapseIconHTML=function(){return 0!==this.children.length?'<span class="glyphicon-chevron-right glyphicon"></span>':""},ROSLIB.DiagnosticsDirectory.prototype.hasChildren=function(){return 0!==this.children.length},ROSLIB.DiagnosticsHistory=function(a){"undefined"==typeof a&&(a={}),this.root=new ROSLIB.DiagnosticsDirectory({name:"root"})},ROSLIB.DiagnosticsHistory.prototype.registerStatus=function(a){for(var b=this.root,c=0;c<a.path.length;c++){var d=b.findDirectory(a.path[c]);null===d&&(d=b.createChild(a.path[c])),b=d}return b.registerStatus(a),b},ROSLIB.DiagnosticsStatus=function(a){"undefined"==typeof a&&(a={}),this.name=a.name,this.message=a.message,this.level=a.level,this.hardware_id=a.hardware_id,this.values={},this.stamp=a.timestamp;for(var b=0;b<a.values.length;b++)this.values[a.values[b].key]=a.values[b].value;this.path=_.filter(this.name.split("/"),function(a){return a.toString()!=="".toString()})},ROSLIB.DiagnosticsStatus.LEVEL={OK:0,WARN:1,ERROR:2},ROSLIB.DiagnosticsStatus.prototype.isOK=function(){return this.level===ROSLIB.DiagnosticsStatus.LEVEL.OK},ROSLIB.DiagnosticsStatus.prototype.isWARN=function(){return this.level===ROSLIB.DiagnosticsStatus.LEVEL.WARN},ROSLIB.DiagnosticsStatus.prototype.isERROR=function(){return this.level===ROSLIB.DiagnosticsStatus.LEVEL.ERROR},ROSLIB.DiagnosticsStatus.createFromArray=function(a){var b=a.header,c=ROSLIB.Time.fromROSMsg(b);return _.map(a.status,function(a){return new ROSLIB.DiagnosticsStatus({timestamp:c,name:a.name,message:a.message,hardware_id:a.hardware_id,level:a.level,values:a.values})})},ROSLIB.DiagnosticsStatus.prototype.levelString=function(){return this.isERROR()?"Error":this.isWARN()?"Warn":this.isOK()?"OK":void 0},ROSLIB.DiagnosticsPlotInfo=function(){var a=this;a.clearInfo()},ROSLIB.DiagnosticsPlotInfo.prototype.getDirectories=function(){var a=this;return _.filter(a.plotting_directories,function(b){return b.status.values.hasOwnProperty(a.plotting_field)?!0:!1})},ROSLIB.DiagnosticsPlotInfo.prototype.clearInfo=function(){var a=this;a.plotting_field=null,a.plotting_directories=[],a.plot_windows_by_name={}},ROSLIB.DiagnosticsPlotInfo.prototype.registerDirectories=function(a){var b=this;b.plotting_directories=a},ROSLIB.DiagnosticsPlotInfo.prototype.registerField=function(a){var b=this;return b.plotting_field=a,b.plotting_field},ROSLIB.DiagnosticsPlotInfo.prototype.plotValues=function(){var a=this,b=a.plotting_field,c={};return _.forEach(a.plotting_directories,function(a){c[a.fullName()]=a.status.values.hasOwnProperty(b)?a.status.values[b]:null}),{field:b,values:c}},ROSLIB.DiagnosticsPlotInfo.prototype.plottable=function(){var a=this;return null!==a.plotting_field&&0!==a.plotting_directories.length},ROSLIB.DiagnosticsPlotInfo.prototype.plotFieldID=function(){for(var a=this;!a.plot_field_id;){for(var b="",c="abcdefghijklmnopqrstuvwxyz",d=0;10>d;d++)b+=c.charAt(Math.floor(Math.random()*c.length));if(0===$("#"+b).length){a.plot_field_id=b;break}}return a.plot_field_id},ROSLIB.DiagnosticsPlotInfo.prototype.preparePlotWindows=function(a,b){var c=this;c.name=a,_.forEach(c.plot_windows_by_name,function(a){a.remove()}),c.plot_windows_by_name={},_.forEach(c.getDirectories(),function(a){var b=new ROSLIB.DiagnosticsPlotWindow({directory:a});c.plot_windows_by_name[a.fullName()]=b}),c.$root_html=$('<div class="rwt-plot-info-container" id="'+c.plotFieldID()+'"><div class="plot-info container"><form><div class="row"><div class="col-xs-6"><select class="form-control" disabled><option>'+a+'</option></select></div><div class=" col-xs-5"><select class="form-control" disabled><option>'+c.plotting_field+'</option></select></div><div class=" col-xs-1"><button class="btn btn-danger remove-info-button">remove</button></div></div></form></div><div class="windows-inner"></div></div>'),$("#"+b).prepend(c.$root_html),c.$root_html.find(".remove-info-button").click(function(a){return a.preventDefault(),c.remove(),!1}),c.rearrangePlotWindows(b)},ROSLIB.DiagnosticsPlotInfo.prototype.rearrangePlotWindows=function(a){var b=this,c=_.remove(_.values(b.plot_windows_by_name),function(a){return null===a.getHTMLObject()});_.forEach(c,function(a){delete b.plot_windows_by_name[a.getDirectory().fullName()]});var d=b.$root_html.find(".windows-inner");d.html("");for(var e=null,f=_.values(b.plot_windows_by_name),g=0;g<f.length;g++)g%6===0&&(e&&d.append(e),e=$('<div class="row"></div>')),f[g].initialize({index:g}),e.append(f[g].getHTMLObject());(f.length%6!==0||6===f.length)&&d.append(e);for(var h=0;h<f.length;h++)f[h].initializePlotter();d.find(".close").click(function(){b.rearrangePlotWindows(a)})},ROSLIB.DiagnosticsPlotInfo.prototype.plot=function(){var a=this,b=a.plotValues();for(var c in b.values){var d=b.values[c];d&&!isNaN(d)&&a.plot_windows_by_name.hasOwnProperty(c)&&a.plot_windows_by_name[c].update(d)}},ROSLIB.DiagnosticsPlotInfo.prototype.remove=function(){var a=this;_.forEach(a.plot_windows_by_name,function(a){a.remove()}),$("#"+a.plotFieldID()).remove()},ROSLIB.DiagnosticsPlotWindow=function(a){var b=this;b.directory=a.directory},ROSLIB.DiagnosticsPlotWindow.prototype.getDirectory=function(){var a=this;return a.directory},ROSLIB.DiagnosticsPlotWindow.prototype.initializePlotter=function(){var a=this;a.plotter.initializePlot(a.$html.find(".plot-window-inner"),{margin:{left:20,top:2,bottom:20,right:2},yaxis:{auto_scale:!0,auto_scale_margin:.2,min:.1,tick:3}}),a.plotter.clearData()},ROSLIB.DiagnosticsPlotWindow.prototype.initialize=function(a){var b=this;b.index=a.index,b.plotter=new ROSLIB.RWTPlot({max_data:10,timestamp:!0}),b.$html=$('<div class="rwt-diagnostics-plot-window col-xs-2"></div>'),b.$html.data("index",b.index),b.$html.append('<div class="background"><p>'+b.directory.status.name+"</p></div>"),b.$html.append('<div class="plot-window-inner" id="rwt-plot-window-'+b.index+'"></div>'),b.$html.append('<button class="close-button-layer close" type="button">&times;</button>'),b.$html.find(".close").click(function(){b.remove()})},ROSLIB.DiagnosticsPlotWindow.prototype.getHTMLObject=function(){var a=this;return a.$html},ROSLIB.DiagnosticsPlotWindow.prototype.update=function(a){var b=this,c=ROSLIB.Time.now();b.plotter.addData(c,[Number(a)]),b.directory.status.isOK()?b.plotter.setColor(d3.rgb("#5cb85c")):b.directory.status.isWARN()?b.plotter.setColor(d3.rgb("#f0ad4e")):b.directory.status.isERROR()&&b.plotter.setColor(d3.rgb("#d9534f"))},ROSLIB.DiagnosticsPlotWindow.prototype.remove=function(){var a=this;a.$html.remove(),a.$html=null},ROSLIB.RWTDiagnosticsPlotter=function(a){var b=this;b.plotting_infos=[],b.previous_directory_names=[];var c=a.ros;b.history=new ROSLIB.DiagnosticsHistory(a),b.name_select_id=a.name_select_id||"name-select",b.plot_field_select_id=a.plot_field_select_id||"plot-field-select",b.add_button_id=a.add_button_id||"add-button",b.plot_windows_id=a.plot_windows_id||"plot-windows-area";var d=a.diagnostics_agg_topic||"/diagnostics_agg";b.registerNameSelectCallback(),b.registerPlotFieldSelectCallback(),b.registerAddCallback(),b.diagnostics_agg_subscriber=new ROSLIB.Topic({ros:c,name:d,messageType:"diagnostic_msgs/DiagnosticArray"}),b.diagnostics_agg_subscriber.subscribe(function(a){b.diagnosticsCallback(a)})},ROSLIB.RWTDiagnosticsPlotter.prototype.registerAddCallback=function(){var a=this;$("#"+a.add_button_id).click(function(b){var c=new ROSLIB.DiagnosticsPlotInfo;a.plotting_infos.push(c),c.clearInfo();var d=$("#"+a.name_select_id).val(),e=a.history.root.findByName(d),f=[];return f=e.hasChildren()?e.getAllDirectoriesWithoutRoot():[e],c.registerDirectories(f),c.registerField($("#"+a.plot_field_select_id).val()),c.preparePlotWindows(d,a.plot_windows_id),b.preventDefault(),!1})},ROSLIB.RWTDiagnosticsPlotter.prototype.registerPlotFieldSelectCallback=function(){var a=this;$("#"+a.plot_field_select_id).bind("change",function(){})},ROSLIB.RWTDiagnosticsPlotter.prototype.registerNameSelectCallback=function(){var a=this;$("#"+a.name_select_id).bind("change",function(){var b=$(this).attr("value"),c=a.history.root.findByName(b);$("#"+a.plot_field_select_id+" option").remove();var d=!1;if(c.hasChildren()){var e=c.getAllDirectories();_.remove(e,function(a){return a===c});var f=_(e).map(function(a){var b=[];for(var c in a.status.values)if(a.status.values.hasOwnProperty(c)){var d=a.status.values[c];isNaN(Number(d))||b.push(c)}return b}).flatten().uniq().value();f.forEach(function(b){var c=$("<option>"+b+"</option>");c.val(b),$("#"+a.plot_field_select_id).append(c)}),0===f.length&&(d=!0)}else{var g=0;for(var h in c.status.values){var i=$("<option>"+h+"</option>");i.val(h);var j=c.status.values[h],k=Number(j);isNaN(k)||($("#"+a.plot_field_select_id).append(i),g+=1)}0===g&&(d=!0)}if(d){var l=$('<div class="modal fade" id="rwt-robot-plotter-warn-message"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">Error</h4></div><div class="modal-body"><p><span class="label label-warning">'+b+'</span> does not have values which can be plotted</p></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div>');$("body").append(l),l.on("hidden.bs.modal",function(){$("#rwt-robot-plotter-warn-message").remove()}),$("#rwt-robot-plotter-warn-message").modal()}})},ROSLIB.RWTDiagnosticsPlotter.prototype.diagnosticsCallback=function(a){var b=ROSLIB.DiagnosticsStatus.createFromArray(a),c=this;_.forEach(b,function(a){c.history.registerStatus(a)});var d=c.history.root.getAllDirectoriesWithoutRoot();d=_.sortBy(d,function(a){return a.fullName()});var e=!1;if(0===c.previous_directory_names.length)e=!0;else if(c.previous_directory_names.length!==d.length)e=!0;else for(var f=0;f<c.previous_directory_names.length;f++)if(c.previous_directory_names[f].toString()!==d[f].fullName().toString()){e=!0;break}if(e){var g=!0;0===$("#"+c.plot_field_select_id+" option").length&&(g=!1),$("#"+c.name_select_id+" option").remove(),c.previous_directory_names=[],_.forEach(d,function(a){var b=a.fullName(),d=null;if(a.hasChildren()){var e=a.getAllDirectories();d=$("<option>"+b+"/* ("+(e.length-1)+")</option>")}else d=$("<option>"+b+"</option>");d.attr("value",a.fullName()),$("#name-select").append(d),c.previous_directory_names.push(b)}),g||$("#"+c.name_select_id).trigger("change")}_.forEach(c.plotting_infos,function(a){a.plottable()&&a.plot()})},ROSLIB.RWTRobotMonitor=function(a){var b=a.diagnostics_agg_topic||"/diagnostics_agg",c=a.ros;this.last_diagnostics_update=null,this.last_time_id=a.last_time_id,this.history=new ROSLIB.DiagnosticsHistory(a),this.diagnostics_agg_subscriber=new ROSLIB.Topic({ros:c,name:b,messageType:"diagnostic_msgs/DiagnosticArray"});var d=this;this.diagnostics_agg_subscriber.subscribe(function(a){d.diagnosticsCallback(a)}),setTimeout(function(){d.updateLastTimeString()},1e3)},ROSLIB.RWTRobotMonitor.prototype.diagnosticsCallback=function(a){this.last_diagnostics_update=ROSLIB.Time.now();var b=ROSLIB.DiagnosticsStatus.createFromArray(a),c=this;_.forEach(b,function(a){c.history.registerStatus(a)}),this.updateView()},ROSLIB.RWTRobotMonitor.prototype.updateLastTimeString=function(){var a=this;if(a.last_diagnostics_update){var b=ROSLIB.Time.now(),c=b.substract(a.last_diagnostics_update).toSec();$(a.last_time_id).html(Math.floor(c))}else $(a.last_time_id).html(-1);setTimeout(function(){a.updateLastTimeString()},1e3)},ROSLIB.RWTRobotMonitor.prototype.updateView=function(){this.updateErrorList(),this.updateWarnList(),this.updateAllList(),this.registerBrowserCallback()},ROSLIB.RWTRobotMonitor.prototype.updateList=function(a,b,c){$("#"+a+" li").remove();var d=this.history.root.getDirectories(b);d.sort(function(a,b){var c=a.fullName(),d=b.fullName();return c>d?1:d>c?-1:0}),_.forEach(d,function(b){var d='<li class="list-group-item" data-name="'+b.fullName()+'"><span class="glyphicon '+c+'"></span>',e="</li>";$("#"+a).append(d+b.fullName()+":"+b.status.message+e)})},ROSLIB.RWTRobotMonitor.prototype.updateAllList=function(){var a=[];$("#all-list .in, #all-list .collapsing").each(function(){a.push($(this).attr("id"))}),$("#all-list li").remove();for(var b=function(c){var d=$('<li class="list-group-item inner" data-name="'+c.fullName()+'"><a data-toggle="collapse" data-parent="#all-list" href="#'+c.uniqID()+'">'+c.getCollapseIconHTML()+c.getIconHTML()+c.name+"</a></li>");if(0===c.children.length)return d;for(var e=$('<ul class="list-group-item-content collapse no-transition" id="'+c.uniqID()+'"></ul>'),f=0;f<a.length;f++)if(a[f].toString()===c.uniqID().toString()){e.addClass("in");break}for(var g=0;g<c.children.length;g++){var h=c.children[g],i=b(h);e.append(i)}return d.append(e),d},c=0;c<this.history.root.children.length;c++){var d=b(this.history.root.children[c]);$("#all-list").append(d)}},ROSLIB.RWTRobotMonitor.prototype.updateWarnList=function(){this.updateList("warn-list",ROSLIB.DiagnosticsStatus.LEVEL.WARN,"glyphicon-exclamation-sign")},ROSLIB.RWTRobotMonitor.prototype.updateErrorList=function(){this.updateList("error-list",ROSLIB.DiagnosticsStatus.LEVEL.ERROR,"glyphicon-minus-sign")},ROSLIB.RWTRobotMonitor.prototype.registerBrowserCallback=function(){var a=this.history.root;$(".list-group-item").dblclick(function(){if(0===$(this).find(".in").length){var b='<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close dismiss-button" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel">Modal title</h4></div><div class="modal-body"></div><div class="modal-footer"><button type="button" class="btn btn-primary dismiss-button">Close</button></div></div><!-- /.modal-content --></div><!-- /.modal-dialog --> </div><!-- /.modal -->',c=a.findByName($(this).attr("data-name")),d=$(b),e=$("<dl></dl>"),f={"Full name":c.fullName(),Component:c.status.name,"Hardware ID":c.status.hardware_id,Level:c.status.levelString(),Message:c.status.message};for(var g in f)e.append("<dt>"+g+":</dt><dd>"+f[g]+"</dd>");d.find(".modal-body").append(e);var h=$("<dl></dl>");for(var i in c.status.values)h.append("<dt>"+i+":</dt><dd>"+c.status.values[i]+"</dd>");d.find(".modal-title").html(c.fullName()),d.find(".modal-body").append(h),d.find(".dismiss-button").click(function(){d.on("hidden.bs.modal",function(){$("#modal").remove()}),d.modal("hide")}),$(".container").append(d),$("#modal").modal()}})};