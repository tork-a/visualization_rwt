!function(t,e){"use strict";function n(){var t=document.querySelector(".app-active");null!==t.querySelector("div.backdrop-popover")&&t.removeChild(h),v.style.visibility="hidden",v.style.display="none","true"===v.getAttribute("data-virtual")&&document.body.removeChild(v),v=null}function i(){var t=document.createElement("div");return t.classList.add("popover"),t.setAttribute("id",a()),t.setAttribute("data-virtual","true"),document.body.appendChild(t),document.body.lastChild}function o(t){var e="string"==typeof t?t:t.text;return'<li><a class="padded-list" data-value="'+("string"==typeof t?t:t.value)+'">'+e+"</a></li>"}function r(t,e,n){if(!(e instanceof Array))throw new Error("The list of the popover must be an array, "+typeof e+" given");var i='<ul class="list">',r=o;"function"==typeof n&&(r=n);for(var a=0;a<e.length;a++)i+=r(e[a]);i+="</ul>",t.innerHTML=i}function a(){for(var t="",e="abcdefghijklmnopqrstuvwxyz",n=0;n<8;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}function l(e){return!e.classList.contains("active")&&(g=!0,v=e,e.style.display="block",t.setTimeout(function(){e.style.visibility="visible",e.classList.add("active")},10),e.querySelector("ul").scrollTop=0,document.querySelector(".app-page.app-active").appendChild(h),!0)}function c(t,e){var n=document.querySelector(".app-page.app-active");if(null===(e="string"==typeof e?n.querySelector(e):e))throw new Error("The trigger for the popover does not exists");if(l(t)){var i=e.getBoundingClientRect();t.style.width=e.clientWidth+"px",t.style.top=i.top+"px",t.style.left=i.left+"px"}}function s(e,n){if(void 0===n&&(n="left"),l(e)){var i=document.querySelector(".app-page.app-active"),o=i.currentStyle||t.getComputedStyle(i);if("title"===n||"title-left"===n){var r=i.querySelector(".header-bar");e.style.top=r.offsetHeight+"px",e.style.left="title"===n?r.clientWidth/2+parseInt(o.marginLeft)-e.clientWidth/2+"px":16+parseInt(o.marginLeft)+"px"}else"left"!==n&&"right"!==n||(e.style.top="12px","left"===n?e.style.left=16+parseInt(o.marginLeft)+"px":(e.style.left="auto",e.style.right="16px"))}}function u(e){g=!1,v=e,e.classList.contains("active")&&(e.classList.toggle("active"),t.setTimeout(function(){n()},250))}function d(t,e,n){if(null===(e="string"==typeof e?document.querySelector(e):e))throw new Error("The button does not exists");var i=t.getAttribute("id");e.setAttribute("data-popover-id",i),!0===n&&e.setAttribute("data-autobind",!0)}function p(t){return{setList:function(e,n){return r(t,e,n),this},open:function(e){return s(t,e),this},openFrom:function(e){return c(t,e),this},close:function(){return u(t),this},onItemChanged:function(e){return y.push({id:t.getAttribute("id"),callback:e}),this},attachButton:function(e,n){return d(t,e,n),this}}}var f=!1,v=null,g=!1,h=document.createElement("div");h.classList.add("backdrop-popover");var y=[],m=function(t){for(var e={target:null,id:null,direction:null};t&&t!==document;t=t.parentNode){var n=t.getAttribute("data-popover-id");if(null!==n){e.target=t,e.id=n,e.direction="left",!t.classList.contains("title")&&t.classList.contains("pull-left")?e.direction="left":!t.classList.contains("title")&&t.parentNode.classList.contains("pull-left")?e.direction="left":t.classList.contains("title")&&t.classList.contains("pull-left")?e.direction="title-left":t.parentNode&&t.parentNode.classList.contains("pull-left")&&t.classList.contains("title")?e.direction="title-left":t.classList.contains("pull-right")?e.direction="right":t.parentNode&&t.parentNode.classList.contains("pull-right")?e.direction="right":t.classList.contains("center")?e.direction="title":t.parentNode&&t.parentNode.classList.contains("center")?e.direction="title":e.direction="button";break}}return e},b=function(t){for(;t&&t!==document;t=t.parentNode)if(t.classList.contains("popover")&&t.classList.contains("active"))return t;return!1},L=function(t){for(;t&&t!==document;t=t.parentNode)if(t===v)return!0;return!1};document.on(e.event.start,function(t){t=t.originalEvent||t,!b(t.target)&&g&&u(v),f=!1}),document.on(e.event.move,function(t){t=t.originalEvent||t,f=!0}),document.on(e.event.end,function(t){var e=t.target,n=m(e),i=document.querySelector("#"+n.id);if(n.target&&i&&(i.classList.contains("active")&&!f?u(i):"button"===n.direction?c(i,n.target):s(i,n.direction)),null!==e.parentNode&&L(e)&&!f){u(v);var o={text:e.textContent,value:e.getAttribute("data-value"),target:t.target};t=new CustomEvent("itemchanged",{detail:o,bubbles:!0,cancelable:!0});for(var r=document.querySelectorAll('[data-popover-id="'+v.id+'"]'),a=r.length-1;a>=0;a--)"true"===(n=r[a]).getAttribute("data-autobind")&&("textContent"in n?n.textContent=e.textContent:n.innerText=e.innerText);v.dispatchEvent(t);for(a=0;a<y.length;a++){var l=y[a];l.id===v.getAttribute("id")&&l.callback(o)}}}),e.popover=function(t){if("string"==typeof t&&"_caller"===t)return p();if(void 0===t)return p(i());var e="string"==typeof t?document.querySelector(t):t;if(null===e)throw new Error("The popover with ID "+t+" does not exists");return p(e)},e.popoverUtil={closeActive:function(){var t=!!v;return t&&u(v),t}},t.phonon=e,"object"==typeof exports?module.exports=e.popover:"function"==typeof define&&define.amd&&define(function(){return e.popover})}("undefined"!=typeof window?window:this,window.phonon||{});